<div id="class-ranking"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.8/d3.min.js"></script>

<script>
var render_class_ranking = function (W, H, data, tab_id) {

    var readTimeFormat = d3.time.format.utc("%Y-%m-%d").parse,
        printTimeFormat = d3.time.format("%d %b %Y");

    var margin = {top: 75, right: 40, bottom: 20, left: 40};
    var w = W - margin.left - margin.right,
        h = H - margin.top - margin.bottom;

    var svg = d3.select("#" + tab_id)
        .append("svg")
        .attr("width", W)
        .attr("height", H)
        .style("fill", "none");

    var countDay = data.days.length,
        maxCalculatedScore = 100 * countDay;

    var temp = svg.selectAll("g")
        .data(data.classrooms)
        .enter()
        .append("g");

    temp.append("line")
        .attr("x1", 0)
        .attr("y1", 0)
        .attr("x2", function (d) {
            return d.total_calculated_score * w / maxCalculatedScore;
        })
        .attr("y2", 0)
        .attr("stroke-width", "1px")
        .attr("stroke", function (d, i) {
            if (i < 5) return "green";
            else return "red";
        })
        .attr("stroke-opacity", 1);

    temp.append("line")
        .attr("x1", function (d) {
            return d.total_calculated_score * w / maxCalculatedScore;
        })
        .attr("y1", 0)
        .attr("x2", w)
        .attr("y2", 0)
        .attr("stroke-width", "1px")
        .attr("stroke", "grey")
        .attr("stroke-opacity", 1);

    temp.attr("transform", function (d, i) {
        return "translate(" + margin.left + "," + (margin.top + 30 * i) + ")";
    });

    /* Score Marks */
    temp.append("circle")
        .attr("cx", function (d) {
            return d.total_calculated_score * w / maxCalculatedScore;
        })
        .attr("cy", 0)
        .attr("r", 5)
        .style("stroke", function (d, i) {
            if (i < 5) return "green";
            else return "red";
        })
        .style("stroke-width", 2)
        .style("fill", "white");

    /* Classroom's Score Labels*/
    var scores = temp.append("text")
        .text(function (d) {
            return Math.round(d.total_calculated_score);
        })
        .style("fill", "black")
        .attr("x", w)
        .attr("y", 0)
        .style("text-anchor", "end");

    scores.attr("transform", function () {
        return 'translate(30,5)';
    });

    svg.append("text")
        .text("Score")
        .attr("x", w)
        .attr("y", 0)
        .attr("transform", function (d) {
            return "translate(" + margin.left + "," + (margin.top - 20) + ")";
        })
        .style("fill", "black")
        .style("text-anchor", "start");

    /* Classroom Labels */
    var texts = temp.append("text")
        .text(function (d) {
            return d.name;
        })
        .style("fill", "black")
        .attr("y", 0)
        .style("text-anchor", "end");

    texts.attr("transform", function () {
        return 'translate(-5,5)';
    });

    var chartTitle = svg.append("text")
        .text("Class Ranking")
        .attr("x", W / 2)
        .attr("y", "30px")
        .style("font-size", "1.5em")
        .style("text-anchor", "middle")
        .style("fill", "black");

    /* Current Class Ranking Period */
    if (data.days[0] == data.days[data.days.length]) { //
        svg.append("text")
            .text(function (d) {
                return printTimeFormat(readTimeFormat(data.days[0]));
            })
            .attr("y", margin.top - 25)
            .style("text-anchor", "middle")
            .attr("x", W / 2)
            .style("fill", "black")
            .style("font-size", "0.75em");
    } else { //
        svg.append("text")
            .text(function (d) {
                return printTimeFormat(readTimeFormat(data.days[0])) + ' to ' + printTimeFormat(readTimeFormat(data.days[countDay - 1]));
            })
            .attr("y", margin.top - 25)
            .style("text-anchor", "middle")
            .attr("x", W / 2)
            .style("fill", "black")
            .style("font-size", "0.75em");
    }


    svg.append("text")
        .text(function (d) {
            return "Max Score = " + maxCalculatedScore;
        })
        .attr("y", 410)
        .style("text-anchor", "middle")
        .attr("x", W / 2)
        .style("fill", "black");
};

var data = {"days": ["2015-11-09", "2015-11-10", "2015-11-11", "2015-11-12", "2015-11-13", "2015-11-14", "2015-11-15"], "classrooms": [{"total_calculated_score": 198.14814814814815, "scores": [{"raw_max": 54, "raw_score": 40, "calculated_score": 74.07407407407408}, {"raw_max": 54, "raw_score": 46, "calculated_score": 85.18518518518519}, {"raw_max": 54, "raw_score": 21, "calculated_score": 38.88888888888889}, {"raw_max": 54, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 54, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 54, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 54, "raw_score": 0, "calculated_score": 0.0}], "name": "4/4"}, {"total_calculated_score": 196.0, "scores": [{"raw_max": 50, "raw_score": 40, "calculated_score": 80.0}, {"raw_max": 50, "raw_score": 40, "calculated_score": 80.0}, {"raw_max": 50, "raw_score": 18, "calculated_score": 36.0}, {"raw_max": 50, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 50, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 50, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 50, "raw_score": 0, "calculated_score": 0.0}], "name": "4/1"}, {"total_calculated_score": 190.74074074074073, "scores": [{"raw_max": 54, "raw_score": 41, "calculated_score": 75.92592592592592}, {"raw_max": 54, "raw_score": 47, "calculated_score": 87.03703703703704}, {"raw_max": 54, "raw_score": 15, "calculated_score": 27.77777777777778}, {"raw_max": 54, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 54, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 54, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 54, "raw_score": 0, "calculated_score": 0.0}], "name": "4/6"}, {"total_calculated_score": 184.9056603773585, "scores": [{"raw_max": 53, "raw_score": 35, "calculated_score": 66.0377358490566}, {"raw_max": 53, "raw_score": 46, "calculated_score": 86.79245283018868}, {"raw_max": 53, "raw_score": 17, "calculated_score": 32.075471698113205}, {"raw_max": 53, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 53, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 53, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 53, "raw_score": 0, "calculated_score": 0.0}], "name": "4/7"}, {"total_calculated_score": 167.92452830188677, "scores": [{"raw_max": 53, "raw_score": 38, "calculated_score": 71.69811320754717}, {"raw_max": 53, "raw_score": 39, "calculated_score": 73.58490566037736}, {"raw_max": 53, "raw_score": 12, "calculated_score": 22.641509433962266}, {"raw_max": 53, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 53, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 53, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 53, "raw_score": 0, "calculated_score": 0.0}], "name": "4/3"}, {"total_calculated_score": 166.03773584905662, "scores": [{"raw_max": 53, "raw_score": 36, "calculated_score": 67.9245283018868}, {"raw_max": 53, "raw_score": 39, "calculated_score": 73.58490566037736}, {"raw_max": 53, "raw_score": 13, "calculated_score": 24.528301886792452}, {"raw_max": 53, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 53, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 53, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 53, "raw_score": 0, "calculated_score": 0.0}], "name": "4/5"}, {"total_calculated_score": 148.07692307692307, "scores": [{"raw_max": 52, "raw_score": 30, "calculated_score": 57.692307692307686}, {"raw_max": 52, "raw_score": 35, "calculated_score": 67.3076923076923}, {"raw_max": 52, "raw_score": 12, "calculated_score": 23.076923076923077}, {"raw_max": 52, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 52, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 52, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 52, "raw_score": 0, "calculated_score": 0.0}], "name": "4/2"}, {"total_calculated_score": 146.2962962962963, "scores": [{"raw_max": 54, "raw_score": 30, "calculated_score": 55.55555555555556}, {"raw_max": 54, "raw_score": 34, "calculated_score": 62.96296296296296}, {"raw_max": 54, "raw_score": 15, "calculated_score": 27.77777777777778}, {"raw_max": 54, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 54, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 54, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 54, "raw_score": 0, "calculated_score": 0.0}], "name": "4/8"}, {"total_calculated_score": 115.9090909090909, "scores": [{"raw_max": 44, "raw_score": 22, "calculated_score": 50.0}, {"raw_max": 44, "raw_score": 25, "calculated_score": 56.81818181818182}, {"raw_max": 44, "raw_score": 4, "calculated_score": 9.090909090909092}, {"raw_max": 44, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 44, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 44, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 44, "raw_score": 0, "calculated_score": 0.0}], "name": "4/9"}, {"total_calculated_score": 102.04081632653059, "scores": [{"raw_max": 49, "raw_score": 21, "calculated_score": 42.857142857142854}, {"raw_max": 49, "raw_score": 27, "calculated_score": 55.10204081632652}, {"raw_max": 49, "raw_score": 2, "calculated_score": 4.081632653061225}, {"raw_max": 49, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 49, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 49, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 49, "raw_score": 0, "calculated_score": 0.0}], "name": "4/11"}, {"total_calculated_score": 6.249999999999999, "scores": [{"raw_max": 48, "raw_score": 2, "calculated_score": 4.166666666666666}, {"raw_max": 48, "raw_score": 1, "calculated_score": 2.083333333333333}, {"raw_max": 48, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 48, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 48, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 48, "raw_score": 0, "calculated_score": 0.0}, {"raw_max": 48, "raw_score": 0, "calculated_score": 0.0}], "name": "4/10"}], "is_sample_data": false};

render_class_ranking(300, 600, data, 'class-ranking');
</script>
